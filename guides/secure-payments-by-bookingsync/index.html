<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>BookingSync API documentation</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/stylesheets/application.css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
    <link rel="stylesheet" href="/highlight.css">
    <script src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="/assets/javascripts/application.js"></script>

    <!-- you don't need to keep this, but it's cool for stats! -->
    <meta name="generator" content="nanoc 3.8.0">
  </head>
  <body class="flex-col">
    <div class="page-wrapper flex-1 flex-col">
      <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle sidebar-toggle collapsed" data-toggle="collapse" data-target="#navigation" aria-expanded="false">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">
              <img alt="BookingSync" src="/images/bookingsync.svg">
              <span>Developers</span>
            </a>
          </div>

          <div class="collapse navbar-collapse" id="navigation">
            <ul class="nav navbar-nav navbar-right">
              <li class="active">
                <a href="/guides/">Guides</a>
              </li>
              <li class="">
                <a href="/reference/">API Reference</a>
              </li>
              <li><a href="https://www.bookingsync.com" target="_blank">BookingSync.com</a></li>
              <li><a href="https://github.com/BookingSync/bookingsync-api-docs" target="_blank"><i class="fa fa-github fa-fw fa-2x"></i></a></li>
            </ul>
          </div>
        </div>
      </nav>

<div class="container content">
  <div class="row">
    <div class="col-md-3 col-md-push-9">
      <div class="panel panel-default">
        <div class="list-group">
          <a class="list-group-item" href="/guides/">Introduction</a>
            <a class="list-group-item" href="/guides/gdpr">GDPR</a>
          <a class="list-group-item" href="/guides/create-a-booking-with-a-source">Create a Booking with a Source</a>
          <a class="list-group-item" href="/guides/read-all-authorized-accounts-at-once">Read all authorized accounts at once</a>
          <a class="list-group-item" href="/guides/getting-started-with-php">Getting Started with PHP</a>
          <a class="list-group-item" href="/guides/pricing-concepts">Pricing concepts</a>
          <a class="list-group-item" href="/guides/api-best-practices">API best practices</a>
          <a class="list-group-item" href="/guides/secure-payments-by-bookingsync">Secure Payments By BookingSync</a>
          <a class="list-group-item" href="/guides/webhook-subscriptions">Webhook subscriptions</a>
          <a class="list-group-item" href="/guides/oauth-scopes">OAuth scopes</a>
          <a class="list-group-item" href="/guides/bookigsync-universe-api-early-beta">BookingSync Universe API [EARLY BETA]</a>
          <a class="list-group-item" href="/guides/updated-since-flow">updated_since flow</a>
          <a class="list-group-item" href="/guides/understanding-los-records">Understanding LOS Records</a>
          <a class="list-group-item" href="/guides/understanding-midterm-pricing">Understanding Midterm Pricing</a>
        </div>
      </div>
    </div>
    <div class="col-md-9 col-md-pull-3">
      <div class="panel panel-default">
        <div class="panel-body guide-body">
          <h2 id="secure-payments-by-bookingsync">Secure Payments By BookingSync</h2>

<ol id="markdown-toc">
  <li><a href="#preface" id="markdown-toc-preface">Preface</a></li>
  <li><a href="#requirements" id="markdown-toc-requirements">Requirements</a></li>
  <li><a href="#instant-booking-flow" id="markdown-toc-instant-booking-flow">Instant Booking Flow</a></li>
  <li><a href="#creating-a-tentative-booking" id="markdown-toc-creating-a-tentative-booking">Creating A Tentative Booking</a></li>
  <li><a href="#creating-a-tentative-payment" id="markdown-toc-creating-a-tentative-payment">Creating A Tentative Payment</a></li>
  <li><a href="#executing-payment" id="markdown-toc-executing-payment">Executing Payment</a></li>
  <li><a href="#testing-payment-execution" id="markdown-toc-testing-payment-execution">Testing Payment Execution</a></li>
</ol>

<h3 id="preface">Preface</h3>

<p>If you have an integration with BookingSync and you create bookings on your side according to the instant booking flow (i.e. a booking gets confirmed only when the credit card payment is executed successfully) and you don’t have PCI DSS compliant payment platform for collecting credit card payments, you can use our Secure Payments By BookingSync flow for this purpose.</p>

<h3 id="requirements">Requirements</h3>

<p>To handle integration with Secure Payments By BookingSync you need to have an application with <code>payments_write</code> or <code>payments_write_owned</code> scope. We recommend using <code>payments_write_owned</code> for this purpose to make sure the payment is not editable by anyone else - only by your application.</p>

<p>Also, the rental for which the booking will be created requires to be instantly bookable and it requires to have a payment gateway assigned (which will be used for executing the credit card payment) which supports rental’s currency.</p>

<p>For client-to-server integration you need to be at least PCI-DSS 3.1 + SAQ-A compliant and for server-to-server integration you need to be SAQ-D compliant.</p>

<h3 id="instant-booking-flow">Instant Booking Flow</h3>

<p>The primary idea behind Instant Booking Flow is to require successful credit card payment to confirm the booking.</p>

<p>Here are the steps that we recommend to follow for this flow:</p>

<ul>
  <li>Create a tentative booking</li>
  <li>Create a tentative instant booking payment</li>
  <li>Send credit card data and payment id to our PCI DSS compliant payment platform for executing the payment, which will confirm both booking and payment if the payment is successfully executed</li>
</ul>

<p>Let’s focus on each point separately.</p>

<h3 id="creating-a-tentative-booking">Creating A Tentative Booking</h3>

<p>Instant Booking flow requires payment to confirm the booking, so we recommend creating a tentative booking and leaving the confirmation to our PCI DSS compliant platform. The confirmation process should take up to few minutes, so we recommend to set tentative expire date to 5 or 10 minutes from now. To create a tentative booking you need to provide 2 params (besides the requires one):</p>

<ul>
  <li>tentative_expires_at - to set the expiry date</li>
  <li>booked - set it to <code>false</code>
</li>
</ul>

<p>You can find more about the bookings’ attributes and how to create them in the <a href="/reference/endpoints/bookings/">bookings endpoint documentation</a>.</p>

<h3 id="creating-a-tentative-payment">Creating A Tentative Payment</h3>

<p>Another step would be creating a tentative payment (i.e. not confirmed payment) of <code>instant-booking</code> kind for the given booking. This payment will get confirmed once the successful credit card payment is executed. Here the essential attributes you need to provide for such payment:</p>

<ul>
  <li>amount_in_cents - amount in cents for the payment that will be charged</li>
  <li>currency -  currency of the payment (must be the same as booking’s currency)</li>
  <li>kind - use <code>instant-booking</code>
</li>
</ul>

<p>We also recommend including more details like <code>fullname</code>, <code>email</code>, <code>zip</code> and other address related field.</p>

<p>You can find more about the payments’ attributes and how to create them in the <a href="/reference/endpoints/payments/">payments endpoint documentation</a>.</p>

<h3 id="executing-payment">Executing Payment</h3>

<p>Once you have created a payment, you need to execute the payment using its id and the credit card data.</p>

<p>The URL of our PCI DSS compliant payment platform for executing credit card payments is the following: <code>https://secure.bookingsync.com/api/bookingsync/instant_bookings</code>.</p>

<p>To execute the payment you need to provide the following attributes:</p>

<ul>
  <li>tentative_payment_id - <strong>required</strong> - id of the tentative payment</li>
  <li>card_number - <strong>required</strong> - credit card’s number</li>
  <li>cardholder_name - <strong>required</strong> - name of the cardholder</li>
  <li>expires_at_month - <strong>required</strong> - expiry month of the credit card</li>
  <li>expires_at_year - <strong>required</strong> - expiry year of the credit card</li>
  <li>security_code - <strong>required</strong> - verification value (CVV) of the credit card</li>
  <li>address1 - <strong>required</strong> - adress1 line for the billing info</li>
  <li>address2 - adress2 line for the billing info</li>
  <li>zip - <strong>required</strong> - zip for the billing info</li>
  <li>city - <strong>required</strong> - city for the billing info</li>
  <li>state - state for the billing info</li>
  <li>country_code - <strong>required</strong> - country code for the billing info</li>
  <li>gateway_id - <strong>required</strong> - id of used payment gateway</li>
  <li>gateway_name - <strong>required</strong> - name of used payment gateway</li>
  <li>gateway_type - <strong>required</strong> - type of used payment gateway</li>
</ul>

<p>Here’s an example of the expected payload:</p>

<pre><code class="language-json"><span class="p">{</span>
  <span class="nt">"card_number"</span><span class="p">:</span> <span class="mi">4111111111111111</span><span class="p">,</span>
  <span class="nt">"cardholder_name"</span><span class="p">:</span> <span class="s2">"John Doe"</span><span class="p">,</span>
  <span class="nt">"expires_at_month"</span><span class="p">:</span> <span class="s2">"12"</span><span class="p">,</span>
  <span class="nt">"expires_at_year"</span><span class="p">:</span> <span class="s2">"2020"</span><span class="p">,</span>
  <span class="nt">"security_code"</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span>
  <span class="nt">"address1"</span><span class="p">:</span> <span class="s2">"some address 1 / 10"</span><span class="p">,</span>
  <span class="nt">"zip"</span><span class="p">:</span> <span class="s2">"12312"</span><span class="p">,</span>
  <span class="nt">"city"</span><span class="p">:</span> <span class="s2">"San Francisco"</span><span class="p">,</span>
  <span class="nt">"state"</span><span class="p">:</span> <span class="s2">"California"</span><span class="p">,</span>
  <span class="nt">"country_code"</span><span class="p">:</span> <span class="s2">"US"</span><span class="p">,</span>
  <span class="nt">"gateway_id"</span><span class="p">:</span> <span class="s2">"123"</span><span class="p">,</span>
  <span class="nt">"gateway_name"</span><span class="p">:</span> <span class="s2">"payment_gateway_name"</span><span class="p">,</span>
  <span class="nt">"gateway_type"</span><span class="p">:</span> <span class="s2">"PaymentGateway"</span>
<span class="p">}</span></code></pre>

<p>There are 3 possible responses:</p>

<ol>
  <li>
    <p>Successful - with status code <code>200</code> and no response body - it means that the payment has been successfully authorized and has been enqueued to be captured asynchronously. Once the credit card payment is captured, it will be confirmed on the BookingSync side - the payment will be updated with <code>transaction_id</code> and <code>paid_at</code> values and the related booking will be confirmed - marked as booked.</p>
  </li>
  <li>
    <p>Partial Success - with status code <code>202</code> and response body dependent on Payment Gateway. This status means that payment requires authentication.</p>
  </li>
</ol>

<p>BookingPay Gateway</p>

<pre><code class="language-json"><span class="p">{</span>
  <span class="nt">"enrollmentId"</span><span class="p">:</span> <span class="s2">"sample_enrollment_id_123"</span><span class="p">,</span>
  <span class="nt">"acsURL"</span><span class="p">:</span> <span class="s2">"https://test-threedsecure.centralpay.net/acs"</span><span class="p">,</span>
  <span class="nt">"paReq"</span><span class="p">:</span> <span class="s2">"paReq"</span><span class="p">,</span>
  <span class="nt">"gateway_name"</span><span class="p">:</span> <span class="s2">"booking_pay"</span><span class="p">,</span>
  <span class="nt">"uuid"</span><span class="p">:</span> <span class="s2">"lapw8u3k-9583-38l3-m5d9-51c0af5df8cb"</span><span class="p">,</span>
  <span class="nt">"order_id"</span><span class="p">:</span> <span class="s2">"BS-123"</span>
<span class="p">}</span></code></pre>

<p>Ogone Gateway</p>

<pre><code class="language-json"><span class="p">{</span>
  <span class="nt">"gateway_name"</span><span class="p">:</span> <span class="s2">"ogone"</span><span class="p">,</span>
  <span class="nt">"HTML_ANSWER"</span><span class="p">:</span> <span class="s2">"html_answer_that_is_Base64_encoded_form"</span><span class="p">,</span>
  <span class="nt">"uuid"</span><span class="p">:</span> <span class="s2">"lapw8u3k-9583-38l3-m5d9-51c0af5df8cb"</span>
<span class="p">}</span></code></pre>

<p>Stripe Gateway</p>

<pre><code class="language-json"><span class="p">{</span>
  <span class="nt">"gateway_name"</span><span class="p">:</span> <span class="s2">"stripe"</span><span class="p">,</span>
  <span class="nt">"uuid"</span><span class="p">:</span> <span class="s2">"0fc0476e-1267-49e7-a1f4-43c0df5dc8fd"</span><span class="p">,</span>
  <span class="nt">"next_action"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"redirect_to_url"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">"return_url"</span><span class="p">:</span> <span class="s2">"https://bookingsync.com?order_id=BS-123-1562441767"</span><span class="p">,</span>
      <span class="nt">"url"</span><span class="p">:</span> <span class="s2">"https://hooks.stripe.com/..."</span>
    <span class="p">},</span>
    <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"redirect_to_url"</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>

<div class="callout callout-info">
  <h4>Successful authentication after 202 status</h4>
  <p>After successful authentication a traveller will be redirected to BookingSync success page. There is no possibility to customize this redirection.</p>
</div>

<ol start="3">
  <li>Failure - with status code <code>422</code> and validation errors inside response body. Here’s an example of possible validation errors:</li>
</ol>

<pre><code class="language-json"><span class="p">{</span>
  <span class="nt">"tentative_payment_id"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"can't be blank"</span><span class="p">]</span>
<span class="p">}</span></code></pre>

<p>The essential validation includes presence validation of the required attributes, credit card data and ability to authorize the payment.</p>

<p>All credit card errors are handled inside <code>credit_card</code> attribute, here’s an example:</p>

<pre><code class="language-json"><span class="p">{</span>
  <span class="nt">"credit_card"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"number - is not a valid credit card number"</span><span class="p">]</span>
<span class="p">}</span></code></pre>

<p>To indicate problems with authorizing the payment we use <code>payment</code> attribute, here’s an example:</p>

<pre><code class="language-json"><span class="p">{</span>
  <span class="nt">"payment"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"authorization declined"</span><span class="p">]</span>
<span class="p">}</span></code></pre>

<p>There are 3 edgecases that shouldn’t happen too often, but are possible:</p>

<ul>
  <li>API connection problem - if the payment platform cannot establish a connection with BookingSync API, the error will be returned for <code>api</code> attribute.</li>
  <li>Data problem - if the payment gateway was not set for the rental, the error will be returned for <code>data</code> attribute.</li>
  <li>Other errors - if there is any different error, it will be returned for <code>server</code> attribute.</li>
</ul>

<h3 id="testing-payment-execution">Testing Payment Execution</h3>

<p>For testing the payment flow we recommend switching to Bogus gateway, which will prevent from executing a real payment and using one of the following credit card numbers:</p>

<ul>
  <li>
<code>4111 1111 1111 1111</code> - to Simulate an Approved Transaction</li>
  <li>
<code>4111 1111 1111 1112</code> - to Simulate a Declined Transaction</li>
  <li>
<code>4111 1111 1111 1113</code> - To Simulate a Gateway Failure</li>
</ul>

        </div>
      </div>
    </div>
  </div>
</div>
    </div>
  </body>
</html>

